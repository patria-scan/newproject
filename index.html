<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gesti贸n de Expedientes</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
    body { font-family: Arial, sans-serif; background: #0d2c52; color: #fff; text-align: center; margin: 0; padding: 20px; }
    .container { max-width: 500px; margin: auto; background: #143e6d; padding: 20px; border-radius: 10px; }
    select, button { width: 100%; padding: 10px; margin-top: 10px; font-size: 16px; border-radius: 5px; border: none; }
    #reader { width: 100%; margin-top: 15px; }
    #result { margin-top: 10px; padding: 10px; border-radius: 5px; min-height: 40px; }
    .success { background: rgba(92,184,92,0.2); color: #5cb85c; }
    .error { background: rgba(217,83,79,0.2); color: #d9534f; }
    .sending { background: rgba(255,193,7,0.2); color: #ffc107; }
</style>
</head>
<body>

<h1> Gesti贸n de Expedientes</h1>
<div class="container">
    <h3>驴Qui茅n eres?</h3>
    <select id="user"></select>

    <h3>Acci贸n</h3>
    <select id="action">
        <option value="">-- Selecciona una acci贸n --</option>
        <option value="Enviado a Jur铆dico">Enviado a Jur铆dico</option>
        <option value="Enviado a Contabilidad">Enviado a Contabilidad</option>
        <option value="Archivo">Archivo</option>
        <option value="Retornado a Almac茅n">Retornado a Almac茅n</option>
    </select>

    <div id="reader"></div>
    <div id="result"></div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx6c3eP7KnWlcM2HyCzEs7EPnCw-c2M2AGSubBqLlgOCcXapTEjSiKNeSHI5Jlp-ZpM/exec"; // Cambia esto por tu Web App URL
const usuarios = [
    "AMBIORIX MARTINEZ","ANNY SALAZAR","CARLENYS THOMPSON","CAROLINE QUEZADA","CLARA MARIN",
    "ELBA GOMEZ","EMMANUEL MARTE GUERRERO","ERIDANIA RAMOS","ESTRELLA MASSIEL CHALAS OCHOA",
    "FEDERICO CARLOS TORIBIO AMARO","FELIX ORTIZ","ISAMAR ROSARIO","JOAN BENCOSME",
    "LAURA ESTHER GUZMAN","LAURA MARCIEL ESPAILLAT","LEO DIAZ","MIGUEL CORDERO","MINERVA PAULINO",
    "NAILETH BETANIA MARTINEZ","RAMONA DURAN","REYNELD ABREU","SAMMY MOLINA","SHARLINNE HEYER",
    "YORGELIS DE LOS SANTOS"
];
const userSelect = document.getElementById("user");
usuarios.forEach(u => {
    let opt = document.createElement("option");
    opt.value = u;
    opt.textContent = u;
    userSelect.appendChild(opt);
});

// Cargar selecci贸n previa
userSelect.value = localStorage.getItem("usuario") || "";
document.getElementById("action").value = localStorage.getItem("accion") || "";

userSelect.addEventListener("change", () => localStorage.setItem("usuario", userSelect.value));
document.getElementById("action").addEventListener("change", () => localStorage.setItem("accion", document.getElementById("action").value));

function onScanSuccess(qrCodeMessage) {
    const usuario = userSelect.value;
    const accion = document.getElementById("action").value;
    const resultDiv = document.getElementById("result");

    if (!usuario || !accion) {
        resultDiv.textContent = "Selecciona usuario y acci贸n antes de escanear";
        resultDiv.className = "error";
        return;
    }

    resultDiv.textContent = "Enviando datos...";
    resultDiv.className = "sending";

    fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify({ row: qrCodeMessage, nombre: usuario, accion }),
        headers: { "Content-Type": "application/json" }
    })
    .then(res => res.json())
    .then(data => {
        resultDiv.textContent = data.message;
        resultDiv.className = data.status === "success" ? "success" : "error";
    })
    .catch(err => {
        resultDiv.textContent = "Error de conexi贸n: " + err.message;
        resultDiv.className = "error";
    });
}

new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 }).render(onScanSuccess);
</script>

</body>
</html>
